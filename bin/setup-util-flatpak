#!/usr/bin/env bash
source "$DOTFILES/sources/strict.bash"

# https://www.flatpak.org/setup/Ubuntu/
# https://wiki.manjaro.org/index.php/Flatpak

# =====================================
# Checks

# check that an accident has not occured
if ! is-linux; then
	echo-style --notice="[$0] is only intended to be run on Linux systems, skipping." >/dev/stderr
	exit 0
fi

# check applicability
if test "${ACTION-}" = 'update' && command-missing flatpak; then
	echo-style --notice="[flatpak] is missing, and we are update only, skipping." >/dev/stderr
	exit 0
fi

# =====================================
# Action

env NAME='Flatpak' CLI='flatpak' \
	APT='flatpak' \
	PAMAC='flatpak' \
	setup-util

flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

if command-exists gnome-software; then
	env NAME='Flatpak via Gnome Software' \
		APT='gnome-software-plugin-flatpak' \
		setup-util || :
fi

flatpak update -y

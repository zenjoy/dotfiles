#!/usr/bin/env bash
source "$DOTFILES/sources/strict.bash"

# =====================================
# Checks

# check that an accident has not occured
if ! is-apk; then
	echo-style --notice="[$0] is for Linux systems with [apk] installed, skipping." >/dev/stderr
	exit 0
fi

# =====================================
# Start

echo-segment --h1='Setup APK'

# =====================================
# Configuration

source "$DOTFILES/sources/config.bash"

# setup.bash provides:
APK_INSTALL=()
load_dotfiles_config 'setup.bash'

# adjustments
mapfile -t APK_INSTALL < <(prepare_packages 'APK_INSTALL' -- "${APK_INSTALL[@]}")

# =====================================
# Packages

# install
function install_apk_bulk() {
	echo-segment --h2="Install $# apk packages"
	if test "$#" -ne 0; then
		env CONFIRM= NAME="apk:$*" APK="$*" setup-util apk
	fi
	echo-segment --g2="Install $# apk packages"
}
install_apk_bulk "${APK_INSTALL[@]}"

# =====================================
# Finish

echo-segment --g1="Setup APK"

#!/usr/bin/env bash
# shellcheck disable=SC2164,SC2103
source "$DOTFILES/sources/strict.bash"

path="${1-}"
if test -z "$path" -o "$path" = '.'; then
	# handles [fs-parent] and [fs-parent .]
	cd ..
	pwd
elif test -d "$path"; then
	# handles [fs-parent ..] and [fs-parent ./..]
	cd "$path"
	cd ..
	pwd
elif test -e "$path"; then
	# handles files, in which case we just want the directory that contains the file
	# not the directory that contains the direcvtory that contains the file
	cd "$(dirname "$path")"
	pwd
else
	# the path doesn't exist, so just infer it by trimming the basename
	basename="$(basename "$path")"
	parent="${path%"/$basename"}"
	if test "$parent" != "$path"; then
		echo "$parent"
	else
		cat <<-EOF >/dev/stderr
			$(echo-style --error="ERROR:")
			Unable to determine the parent directory for the non-existent path: $(echo-style --code="$path")
		EOF
		exit 1
	fi
fi

# Why?
# [dirname .] outputs [.]
# [dirname ..] outputs [.]
# [dirname <a-symlinked-directory>] outputs [.]
# [dirname "$HOME"] outputs [/Users]

#!/usr/bin/env bash
source "$DOTFILES/sources/strict.bash"

# dependencies
env QUIET=yes setup-util-netstat

# ask
what="$(
	choose-option \
		--question='What do you want to check for?' \
		--filter="${1-}" -- dns everything
)"

# check
if command-missing 'ss'; then
	echo-style --dim+red='[ss] command missing, cannot just fetch DNS' >/dev/stderr
	what='everything'
fi

# fetch
if test "$what" = 'dns'; then
	# what is listening on dns port 53
	sudo ss -lp 'sport = :domain'
else
	sudo netstat -tunl
fi

#!/usr/bin/env bash
source "$DOTFILES/sources/strict.bash"

# help
if is-help "$@"; then
	cat <<-EOF >/dev/stderr
		USAGE:
		unziptar [archive file path] [--flags...]

		FLAGS:
		Provide [--destination=...] to specify which directory the archive will be extracted to, defaults to the pwd.
		Provide [--format=...] to manually specify format, for cases where it cannot be determined from the filename.
	EOF
	exit 22 # Invalid argument
fi

# options
filename="$(
	ask --required \
		--question="Enter the path of the archive to extract." \
		--default="${1-}"
)"
destination="$(get-flag-value destination -- "$@")" # custom destination
format="$(get-flag-value format -- "$@")"           # zip | tar | original filename, say a URL or so, before archive-file became a tmp file
if test -z "$format"; then
	format="$filename"
fi

filepath="$(fs-absolute "$filename")"

if test "$format" = 'zip' || [[ "$format" = *".zip" ]]; then
	if test -n "$destination"; then
		unzip "$filepath" -d "$destination"
	else
		unzip "$filepath"
	fi
else
	if test -n "$destination"; then
		mkdir -p "$destination"
		cd "$destination" || exit 1
		tar -xvzf "$filepath"
	else
		tar -xvzf "$filepath"
	fi
fi

#!/usr/bin/env bash
source "$DOTFILES/sources/strict.bash"

# prepare
log="$(mktemp)"
cd "$1" || exit 1

# log
ok silent git-protocol-ensure origin
ok silent git config pull.ff only

# update, redirecting via &> all stderr and stdout to the log file
if ! git pull origin "$(git-default-branch)" &>"$log"; then
	# update failed
	echo 'failure'
	stderr cat "$log"
	rm "$log"
	exit 1
elif grep -q "Already" <"$log"; then
	# already up to date
	echo 'current'
	rm "$log"
else
	# updated successfully
	echo 'updated'
	stderr cat "$log"
	rm "$log"
	exit 0
fi
